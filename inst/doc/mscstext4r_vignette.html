<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Phil Ferriere" />


<title>{mscstexta4r} vignette</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">{mscstexta4r} vignette</h1>
<h4 class="author"><em>Phil Ferriere</em></h4>
<h4 class="date"><em>June 2016</em></h4>



<div id="whats-the-text-analytics-rest-api" class="section level2">
<h2>What’s the Text Analytics REST API?</h2>
<p>Per Microsoft’s website, the <a href="https://www.microsoft.com/cognitive-services/en-us/text-analytics/documentation">Text Analytics REST API</a> is a suite of text analytics web services built with Azure Machine Learning that can be used to analyze unstructured text. The API supports the following operations:</p>
<ul>
<li>Sentiment analysis - Is a sentence or document generally positive or negative?</li>
<li>Topic detection - What’s being discussed across a list of documents/reviews/articles?</li>
<li>Language detection - What language is a document written in?</li>
<li>Key talking points extraction - What’s being discussed in a single document?</li>
</ul>
<div id="sentiment-analysis" class="section level3">
<h3>Sentiment analysis</h3>
<p>The API returns a numeric score between 0 and 1. Scores close to 1 indicate positive sentiment and scores close to 0 indicate negative sentiment. Sentiment score is generated using classification techniques. The input features of the classifier include n-grams, features generated from part-of-speech tags, and word embeddings. English, French, Spanish and Portuguese text are supported.</p>
</div>
<div id="topic-detection" class="section level3">
<h3>Topic detection</h3>
<p>This API returns the detected topics for a list of submitted text records. A topic is identified with a key phrase, which can be one or more related words. This API requires a minimum of 100 text records to be submitted, but is designed to detect topics across hundreds to thousands of records. The API is designed to work well for short, human-written text such as reviews and user feedback.</p>
</div>
<div id="language-detection" class="section level3">
<h3>Language detection</h3>
<p>This API returns the detected language and a numeric score between 0 and 1. Scores close to 1 indicate 100% certainty that the identified language is correct. A total of 120 languages are supported.</p>
</div>
<div id="extraction-of-key-talking-points" class="section level3">
<h3>Extraction of key talking points</h3>
<p>This API returns a list of strings denoting the key talking points in the input text. English, German, Spanish, and Japanese text are supported.</p>
</div>
</div>
<div id="package-installation" class="section level2">
<h2>Package Installation</h2>
<p>To use the <code>{mscstexta4r}</code> R package, you <strong>MUST</strong> have a valid <a href="https://www.microsoft.com/cognitive-services/en-us/pricing">account</a> with Microsoft Cognitive Services. Once you have an account, Microsoft will provide you with an <a href="https://en.wikipedia.org/wiki/Application_programming_interface_key">API key</a> listed under your subscriptions. After you’ve configured <code>{mscstexta4r}</code> with your API key, you will be able to call the Text Analytics REST API from R, up to your maximum number of transactions per month and per minute.</p>
<p>You can install the latest <strong>stable</strong> version of <code>{mscstexta4r}</code> from CRAN as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">if (<span class="st">&quot;mscstexta4r&quot;</span> %in%<span class="st"> </span><span class="kw">installed.packages</span>()[,<span class="st">&quot;Package&quot;</span>] ==<span class="st"> </span><span class="ot">FALSE</span>) {
  <span class="kw">install.packages</span>(<span class="st">&quot;mscstexta4r&quot;</span>)
}</code></pre></div>
<p>You can also install the <strong>development</strong> version using <code>{devtools}</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">if (<span class="st">&quot;mscstexta4r&quot;</span> %in%<span class="st"> </span><span class="kw">installed.packages</span>()[,<span class="st">&quot;Package&quot;</span>] ==<span class="st"> </span><span class="ot">FALSE</span>) {
  if (<span class="st">&quot;devtools&quot;</span> %in%<span class="st"> </span><span class="kw">installed.packages</span>()[,<span class="st">&quot;Package&quot;</span>] ==<span class="st"> </span><span class="ot">FALSE</span>) {
    <span class="kw">install.packages</span>(<span class="st">&quot;devtools&quot;</span>)
  }
  devtools::<span class="kw">install_github</span>(<span class="st">&quot;philferriere/mscstexta4r&quot;</span>)
}</code></pre></div>
</div>
<div id="package-loading-and-configuration" class="section level2">
<h2>Package Loading and Configuration:</h2>
<p>After loading <code>{mscstexta4r}</code> with <code>library()</code>, you <strong>must</strong> call <code>textaInit()</code> before you can call any of the core <code>{mscstexta4r}</code> functions.</p>
<p>The <code>textaInit()</code> configuration function will first check to see if the variable <code>MSCS_TEXTANALYTICS_CONFIG_FILE</code> exists in the system environment. If it does, the package will use that as the path to the configuration file.</p>
<p>If <code>MSCS_TEXTANALYTICS_CONFIG_FILE</code> doesn’t exist, it will look for the file <code>.mscskeys.json</code> in the current user’s home directory (that’s <code>~/.mscskeys.json</code> on Linux, and something like <code>C:\Users\Phil\Documents\.mscskeys.json</code> on Windows). If the file is found, the package will load the API key and URL from it.</p>
<p>If using a file, please make sure it has the following structure:</p>
<div class="sourceCode"><pre class="sourceCode json"><code class="sourceCode json"><span class="fu">{</span>
  <span class="dt">&quot;textanalyticsurl&quot;</span><span class="fu">:</span> <span class="st">&quot;https://westus.api.cognitive.microsoft.com/texta/analytics/v2.0/&quot;</span><span class="fu">,</span>
  <span class="dt">&quot;textanalyticskey&quot;</span><span class="fu">:</span> <span class="st">&quot;...MSCS Text Analytics API key goes here...&quot;</span>
<span class="fu">}</span></code></pre></div>
<p>If no configuration file is found, <code>textaInit()</code> will attempt to pick up its configuration from two Sys env variables instead:</p>
<p><code>MSCS_TEXTANALYTICS_URL</code> - the URL for the Text Analytics REST API.</p>
<p><code>MSCS_TEXTANALYTICS_KEY</code> - your personal Text Analytics REST API key.</p>
<p><code>textaInit()</code> needs to be called <em>only once</em>, after package load.</p>
</div>
<div id="error-handling" class="section level2">
<h2>Error Handling</h2>
<p>The MSCS Text Analytics API is a <strong><a href="https://en.wikipedia.org/wiki/Representational_state_transfer">RESTful</a></strong> API. HTTP requests over a network and the Internet can fail. Because of congestion, because the web site is down for maintenance, because of firewall configuration issues, etc. There are many possible points of failure.</p>
<p>The API can also fail if you’ve <strong>exhausted your call volume quota</strong> or are <strong>exceeding the API calls rate limit</strong>. Unfortunately, MSCS does not expose an API you can query to check if you’re about to exceed your quota for instance. The only way you’ll know for sure is by <strong>looking at the error code</strong> returned after an API call has failed.</p>
<p>Therefore, you must write your R code with failure in mind. Our preferred way is to use <code>tryCatch()</code>. Its mechanism may appear a bit daunting at first, but it is well <a href="http://www.inside-r.org/r-doc/base/signalCondition">documented</a>. We’ve also included many examples, as you’ll see below.</p>
</div>
<div id="synchronous-vs-asynchronous-execution" class="section level2">
<h2>Synchronous vs Asynchronous Execution</h2>
<p>All but <strong>one</strong> core text analytics functions execute exclusively in synchronous mode. <code>textaDetectTopics()</code> is the only function that can be executed either synchronously or asynchronously. Why? Because topic detection is typically a “batch” operation meant to be performed on thousands of related documents (product reviews, research articles, etc.).</p>
<div id="whats-the-difference" class="section level3">
<h3>What’s the Difference?</h3>
<p>When <code>textaDetectTopics()</code> executes synchronously, you must wait for it to finish before you can move on to the next task. When <code>textaDetectTopics()</code> executes asynchronously, you can move on to something else before topic detection has completed. In the latter case, you will need to call <code>textaDetectTopicsStatus()</code> periodically yourself until the Microsoft Cognitive Services server complete topic detection and results become available.</p>
</div>
<div id="when-to-run-which-mode" class="section level3">
<h3>When to Run Which Mode</h3>
<p>If you’re performing topic detection in batch mode (from an R script), we recommend using the <code>textaDetectTopics()</code> in synchronous mode, in which case, again, it will return only after topic detection has completed.</p>
<p>If you’re calling <code>textaDetectTopics()</code> in synchronous mode within the R console REPL (interactive mode), it will <strong>appear as if the console has hanged</strong>. This is <em>EXPECTED</em>. The function hasn’t crashed. It is simply in “sleep mode”, activating itself periodically and then going back to sleep, until the results have become available. In sleep mode, even though it appears “stuck”, <code>textaDetectTopics()</code> doesn’t use any CPU resources. While the function is operating in sleep mode, you <em>WILL NOT</em> be able to use the console before the function completes.</p>
<p>If you need to operate the console while topic detection is being performed by the Microsoft Cognitive services servers, you should call <code>textaDetectTopics()</code> in asynchronous mode and then call <code>textaDetectTopicsStatus()</code> yourself repeatedly afterwards, until results are available.</p>
</div>
</div>
<div id="package-configuration-with-error-handling" class="section level2">
<h2>Package Configuration with Error Handling</h2>
<p>Here’s some sample code that illustrates how to use <code>tryCatch()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">'mscstexta4r'</span>)
<span class="kw">tryCatch</span>({

  <span class="kw">textaInit</span>()

}, <span class="dt">error =</span> function(err) {

  <span class="kw">geterrmessage</span>()

})</code></pre></div>
<p>If <code>{mscstexta4r}</code> cannot locate <code>.mscskeys.json</code> nor any of the configuration environment variables, the code above will generate the following output:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">[<span class="dv">1</span>] <span class="st">&quot;mscstexta4r: could not load config info from Sys env nor from file&quot;</span></code></pre></div>
<p>Similarly, <code>textaInit()</code> will fail if <code>{mscstexta4r}</code> cannot find the <code>textanalyticskey</code> key in <code>.mscskeys.json</code>, or fails to parse it correctly, etc. This is why it is so important to use <code>tryCatch()</code> with all <code>{mscstexta4r}</code> functions.</p>
</div>
<div id="package-api" class="section level2">
<h2>Package API</h2>
<p>The core API calls exposed by <code>{mscstexta4r}</code> are the following:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Perform sentiment analysis</span>
<span class="kw">textaSentiment</span>(
  documents,                  <span class="co"># Input sentences or documents</span>
  <span class="dt">languages =</span> <span class="kw">rep</span>(<span class="st">&quot;en&quot;</span>, <span class="kw">length</span>(documents))
  <span class="co"># &quot;en&quot;(English, default)|&quot;es&quot;(Spanish)|&quot;fr&quot;(French)|&quot;pt&quot;(Portuguese)</span>
)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Detect top topics in group of documents</span>
<span class="kw">textaDetectTopics</span>(
  documents,                  <span class="co"># At least 100 documents</span>
  <span class="dt">stopWords =</span> <span class="ot">NULL</span>,           <span class="co"># Stop word list (optional)</span>
  <span class="dt">topicsToExclude =</span> <span class="ot">NULL</span>,     <span class="co"># Topics to exclude (optional)</span>
  <span class="dt">minDocumentsPerWord =</span> <span class="ot">NULL</span>, <span class="co"># Threshold to exclude rare topics (optional)</span>
  <span class="dt">maxDocumentsPerWord =</span> <span class="ot">NULL</span>, <span class="co"># Threshold to exclude ubiquitous topics (optional)</span>
  <span class="dt">resultsPollInterval =</span> 30L,  <span class="co"># Poll interval (in s, default: 30s, use 0L for async)</span>
  <span class="dt">resultsTimeout =</span> 1200L,     <span class="co"># Give up timeout (in s, default: 1200s = 20mn)</span>
  <span class="dt">verbose =</span> <span class="ot">FALSE</span>             <span class="co"># If set to TRUE, print every poll status to stdout</span>
)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Detect languages used in documents</span>
<span class="kw">textaDetectLanguages</span>(
  documents,                      <span class="co"># Input sentences or documents</span>
  <span class="dt">numberOfLanguagesToDetect =</span> 1L  <span class="co"># Default: 1L</span>
)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="co"># Get key talking points in documents</span>
<span class="kw">textaKeyPhrases</span>(
  documents,                  <span class="co"># Input sentences or documents</span>
  <span class="dt">languages =</span> <span class="kw">rep</span>(<span class="st">&quot;en&quot;</span>, <span class="kw">length</span>(documents))
  <span class="co"># &quot;en&quot;(English, default)|&quot;de&quot;(German)|&quot;es&quot;(Spanish)|&quot;fr&quot;(French)|&quot;ja&quot;(Japanese)</span>
)</code></pre></div>
<p>The functions <code>textaDetectTopics()</code> returns a S3 class object of the class <code>textatopics</code>. The <code>textatopics</code> object exposes formatted results using several dataframes (documents and their IDs, topics and their IDs, which topics are assigned to which documents), the REST API JSON response (should you care), and the HTTP request (mostly for debugging purposes).</p>
<p>The other functions return S3 class objects of the class <code>texta</code>. The <code>texta</code> object exposes results collected in a single <code>data.frame</code>, the REST API JSON response, and the original HTTP request.</p>
</div>
<div id="sample-code" class="section level2">
<h2>Sample Code</h2>
<p>The following code snippets illustrate how to use {mscstexta4r} functions and show what results they return with toy examples. If after reviewing this code there is still confusion regarding how and when to use each function, please refer to the <a href="https://www.microsoft.com/cognitive-services/en-us/text-analytics/documentation">original documentation</a>.</p>
<div id="sentiment-analysis-1" class="section level3">
<h3>Sentiment Analysis</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">docsText &lt;-<span class="st"> </span><span class="kw">c</span>(
  <span class="st">&quot;Loved the food, service and atmosphere! We'll definitely be back.&quot;</span>,
  <span class="st">&quot;Very good food, reasonable prices, excellent service.&quot;</span>,
  <span class="st">&quot;It was a great restaurant.&quot;</span>,
  <span class="st">&quot;If steak is what you want, this is the place.&quot;</span>,
  <span class="st">&quot;The atmosphere is pretty bad but the food is quite good.&quot;</span>,
  <span class="st">&quot;The food is quite good but the atmosphere is pretty bad.&quot;</span>,
  <span class="st">&quot;The food wasn't very good.&quot;</span>,
  <span class="st">&quot;I'm not sure I would come back to this restaurant.&quot;</span>,
  <span class="st">&quot;While the food was good the service was a disappointment.&quot;</span>,
  <span class="st">&quot;I was very disappointed with both the service and my entree.&quot;</span>
)
docsLanguage &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="st">&quot;en&quot;</span>, <span class="kw">length</span>(docsText))

<span class="kw">tryCatch</span>({

  <span class="co"># Perform sentiment analysis</span>
  <span class="kw">textaSentiment</span>(
    <span class="dt">documents =</span> docsText,    <span class="co"># Input sentences or documents</span>
    <span class="dt">languages =</span> docsLanguage
    <span class="co"># &quot;en&quot;(English, default)|&quot;es&quot;(Spanish)|&quot;fr&quot;(French)|&quot;pt&quot;(Portuguese)</span>
)

}, <span class="dt">error =</span> function(err) {

  <span class="co"># Print error</span>
  <span class="kw">geterrmessage</span>()

})
<span class="co">#&gt; texta [https://westus.api.cognitive.microsoft.com/text/analytics/v2.0/sentiment]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; --------------------------------------</span>
<span class="co">#&gt;              text               score </span>
<span class="co">#&gt; ------------------------------ -------</span>
<span class="co">#&gt;  Loved the food, service and   0.9847 </span>
<span class="co">#&gt;  atmosphere! We'll definitely         </span>
<span class="co">#&gt;            be back.                   </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Very good food, reasonable   0.9831 </span>
<span class="co">#&gt;   prices, excellent service.          </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   It was a great restaurant.   0.9306 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   If steak is what you want,   0.8014 </span>
<span class="co">#&gt;       this is the place.              </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  The atmosphere is pretty bad  0.4998 </span>
<span class="co">#&gt;  but the food is quite good.          </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; The food is quite good but the  0.475 </span>
<span class="co">#&gt;   atmosphere is pretty bad.           </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   The food wasn't very good.   0.1877 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; I'm not sure I would come back 0.2857 </span>
<span class="co">#&gt;      to this restaurant.              </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  While the food was good the   0.08727</span>
<span class="co">#&gt; service was a disappointment.         </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  I was very disappointed with  0.01877</span>
<span class="co">#&gt;    both the service and my            </span>
<span class="co">#&gt;            entree.                    </span>
<span class="co">#&gt; --------------------------------------</span></code></pre></div>
</div>
<div id="topic-detection-synchronous-mode" class="section level3">
<h3>Topic Detection (synchronous mode)</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Load yelpChReviews100 text reviews</span>
<span class="kw">load</span>(<span class="st">&quot;../tests/testthat/data/yelpChineseRestaurantReviews100.rda&quot;</span>)

<span class="kw">tryCatch</span>({

  <span class="co"># Detect top topics</span>
  <span class="kw">textaDetectTopics</span>(
    <span class="dt">documents =</span> yelpChReviews100, <span class="co"># At least 100 docs/sentences</span>
    <span class="dt">stopWords =</span> <span class="ot">NULL</span>,             <span class="co"># Stop word list (optional)</span>
    <span class="dt">topicsToExclude =</span> <span class="ot">NULL</span>,       <span class="co"># Topics to exclude (optional)</span>
    <span class="dt">minDocumentsPerWord =</span> <span class="ot">NULL</span>,   <span class="co"># Threshold to exclude rare topics (optional)</span>
    <span class="dt">maxDocumentsPerWord =</span> <span class="ot">NULL</span>,   <span class="co"># Threshold to exclude ubiquitous topics (optional)</span>
    <span class="dt">resultsPollInterval =</span> 60L,    <span class="co"># Poll interval (in s, default: 30s, use 0L for async)</span>
    <span class="dt">resultsTimeout =</span> 1200L,       <span class="co"># Give up timeout (in s, default: 1200s = 20mn)</span>
    <span class="dt">verbose =</span> <span class="ot">TRUE</span>                <span class="co"># If set to TRUE, print every poll status to stdout</span>
  )

}, <span class="dt">error =</span> function(err) {

  <span class="co"># Print error</span>
  <span class="kw">geterrmessage</span>()

})
<span class="co">#&gt; [Submitting topic detection operation...]</span>
<span class="co">#&gt; [Sleeping for 1 s, timeout in 1200 s...]</span>
<span class="co">#&gt; [operationId: 84e74fee35fb4be48024a26a7267c104, status: NotStarted]</span>
<span class="co">#&gt; [Sleeping for 58 s, timeout in 1197 s...]</span>
<span class="co">#&gt; [operationId: 84e74fee35fb4be48024a26a7267c104, status: Running]</span>
<span class="co">#&gt; [Sleeping for 58 s, timeout in 1137 s...]</span>
<span class="co">#&gt; [operationId: 84e74fee35fb4be48024a26a7267c104, status: Running]</span>
<span class="co">#&gt; [Sleeping for 58 s, timeout in 1077 s...]</span>
<span class="co">#&gt; [operationId: 84e74fee35fb4be48024a26a7267c104, status: Running]</span>
<span class="co">#&gt; [Sleeping for 58 s, timeout in 1017 s...]</span>
<span class="co">#&gt; [operationId: 84e74fee35fb4be48024a26a7267c104, status: Running]</span>
<span class="co">#&gt; [Sleeping for 58 s, timeout in 957 s...]</span>
<span class="co">#&gt; [operationId: 84e74fee35fb4be48024a26a7267c104, status: Running]</span>
<span class="co">#&gt; [Sleeping for 58 s, timeout in 897 s...]</span>
<span class="co">#&gt; [operationId: 84e74fee35fb4be48024a26a7267c104, status: Running]</span>
<span class="co">#&gt; [Sleeping for 58 s, timeout in 837 s...]</span>
<span class="co">#&gt; [operationId: 84e74fee35fb4be48024a26a7267c104, status: Running]</span>
<span class="co">#&gt; [Sleeping for 58 s, timeout in 776 s...]</span>
<span class="co">#&gt; [operationId: 84e74fee35fb4be48024a26a7267c104, status: Succeeded]</span>
<span class="co">#&gt; textatopics [https://westus.api.cognitive.microsoft.com/text/analytics/v2.0/topics?]</span>
<span class="co">#&gt; status: Succeeded</span>
<span class="co">#&gt; operationId: 84e74fee35fb4be48024a26a7267c104</span>
<span class="co">#&gt; operationType: topics</span>
<span class="co">#&gt; topics (first 20):</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; -------------------</span>
<span class="co">#&gt;  keyPhrase   score </span>
<span class="co">#&gt; ----------- -------</span>
<span class="co">#&gt;    soup       19   </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    beef       10   </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    curry       8   </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     egg        7   </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   flavor       7   </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    pork        7   </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    China       6   </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    roll        6   </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   people       5   </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   review       5   </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   wontons      5   </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    sushi       5   </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  delivery      5   </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    town        4   </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Phoenix      4   </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    rolls       4   </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   couple       4   </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   tables       4   </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Buffet       4   </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    yelp        3   </span>
<span class="co">#&gt; -------------------</span></code></pre></div>
</div>
<div id="topic-detection-asynchronous-mode" class="section level3">
<h3>Topic Detection (asynchronous mode)</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Load yelpChReviews100 text reviews</span>
<span class="kw">load</span>(<span class="st">&quot;../tests/testthat/data/yelpChineseRestaurantReviews100.rda&quot;</span>)

<span class="kw">tryCatch</span>({

  <span class="co"># Detect top topics</span>
  operation &lt;-<span class="st"> </span><span class="kw">textaDetectTopics</span>(
    <span class="dt">documents =</span> yelpChReviews100, <span class="co"># At least 100 docs/sentences</span>
    <span class="dt">resultsPollInterval =</span> 0L,     <span class="co"># Poll interval (in s, default: 30s, use 0L for async)</span>
    <span class="dt">verbose =</span> <span class="ot">TRUE</span>                <span class="co"># If set to TRUE, print every poll status to stdout</span>
  )

  <span class="co"># Poll the servers ourselves, until the work completes or until we time out</span>
  resultsPollInterval &lt;-<span class="st"> </span>60L
  resultsTimeout &lt;-<span class="st"> </span>1200L
  startTime &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()
  endTime &lt;-<span class="st"> </span>startTime +<span class="st"> </span>resultsTimeout

  while (<span class="kw">Sys.time</span>() &lt;=<span class="st"> </span>endTime) {
    sleepTime &lt;-<span class="st"> </span>startTime +<span class="st"> </span>resultsPollInterval -<span class="st"> </span><span class="kw">Sys.time</span>()
    if (sleepTime &gt;<span class="st"> </span><span class="dv">0</span>)
      <span class="kw">Sys.sleep</span>(sleepTime)
    startTime &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()

    <span class="co"># Poll for results</span>
    topics &lt;-<span class="st"> </span><span class="kw">textaDetectTopicsStatus</span>(operation, <span class="dt">verbose =</span> <span class="ot">TRUE</span>)
    if (topics$status !=<span class="st"> &quot;NotStarted&quot;</span> &amp;&amp;<span class="st"> </span>topics$status !=<span class="st"> &quot;Running&quot;</span>)
      break;
  }

  topics

}, <span class="dt">error =</span> function(err) {

  <span class="co"># Print error</span>
  <span class="kw">geterrmessage</span>()

})
<span class="co"># Same results as in synchronous mode</span></code></pre></div>
</div>
<div id="language-detection-1" class="section level3">
<h3>Language Detection</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">docsText =<span class="st"> </span><span class="kw">c</span>(
  <span class="st">&quot;The Louvre or the Louvre Museum is the world's largest museum.&quot;</span>,
  <span class="st">&quot;Le musee du Louvre est un musee d'art et d'antiquites situe au centre de Paris.&quot;</span>,
  <span class="st">&quot;El Museo del Louvre es el museo nacional de Francia.&quot;</span>,
  <span class="st">&quot;Il Museo del Louvre a Parigi, in Francia, e uno dei piu celebri musei del mondo.&quot;</span>,
  <span class="st">&quot;Der Louvre ist ein Museum in Paris.&quot;</span>
)

<span class="kw">tryCatch</span>({

  <span class="co"># Detect languages</span>
  <span class="kw">textaDetectLanguages</span>(
    <span class="dt">documents =</span> docsText,           <span class="co"># Input sentences or documents</span>
    <span class="dt">numberOfLanguagesToDetect =</span> 1L  <span class="co"># Number of languages to detect</span>
  )

}, <span class="dt">error =</span> function(err) {

  <span class="co"># Print error</span>
  <span class="kw">geterrmessage</span>()

})
<span class="co">#&gt; texta [https://westus.api.cognitive.microsoft.com/text/analytics/v2.0/languages?numberOfLanguagesToDetect=1]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; -----------------------------------------------------------</span>
<span class="co">#&gt;             text               name    iso6391Name   score </span>
<span class="co">#&gt; ----------------------------- ------- ------------- -------</span>
<span class="co">#&gt;   The Louvre or the Louvre    English      en          1   </span>
<span class="co">#&gt; Museum is the world's largest                              </span>
<span class="co">#&gt;            museum.                                         </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Le musee du Louvre est un   French       fr          1   </span>
<span class="co">#&gt;  musee d'art et d'antiquites                               </span>
<span class="co">#&gt;   situe au centre de Paris.                                </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   El Museo del Louvre es el   Spanish      es          1   </span>
<span class="co">#&gt;  museo nacional de Francia.                                </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Il Museo del Louvre a Parigi, Italian      it          1   </span>
<span class="co">#&gt;   in Francia, e uno dei piu                                </span>
<span class="co">#&gt;   celebri musei del mondo.                                 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Der Louvre ist ein Museum in  German       de          1   </span>
<span class="co">#&gt;            Paris.                                          </span>
<span class="co">#&gt; -----------------------------------------------------------</span></code></pre></div>
</div>
<div id="key-talking-points-extraction" class="section level3">
<h3>Key Talking Points Extraction</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">docsText &lt;-<span class="st"> </span><span class="kw">c</span>(
  <span class="st">&quot;Loved the food, service and atmosphere! We'll definitely be back.&quot;</span>,
  <span class="st">&quot;Very good food, reasonable prices, excellent service.&quot;</span>,
  <span class="st">&quot;It was a great restaurant.&quot;</span>,
  <span class="st">&quot;If steak is what you want, this is the place.&quot;</span>,
  <span class="st">&quot;The atmosphere is pretty bad but the food is quite good.&quot;</span>,
  <span class="st">&quot;The food is quite good but the atmosphere is pretty bad.&quot;</span>,
  <span class="st">&quot;I'm not sure I would come back to this restaurant.&quot;</span>,
  <span class="st">&quot;The food wasn't very good.&quot;</span>,
  <span class="st">&quot;While the food was good the service was a disappointment.&quot;</span>,
  <span class="st">&quot;I was very disappointed with both the service and my entree.&quot;</span>
)
docsLanguage &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="st">&quot;en&quot;</span>, <span class="kw">length</span>(docsText))

<span class="kw">tryCatch</span>({

  <span class="co"># Get key talking points in documents</span>
  <span class="kw">textaKeyPhrases</span>(
    <span class="dt">documents =</span> docsText,    <span class="co"># Input sentences or documents</span>
    <span class="dt">languages =</span> docsLanguage
    <span class="co"># &quot;en&quot;(English, default)|&quot;de&quot;(German)|&quot;es&quot;(Spanish)|&quot;fr&quot;(French)|&quot;ja&quot;(Japanese)</span>
  )

}, <span class="dt">error =</span> function(err) {

  <span class="co"># Print error</span>
  <span class="kw">geterrmessage</span>()

})
<span class="co">#&gt; texta [https://westus.api.cognitive.microsoft.com/text/analytics/v2.0/keyPhrases]</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; -----------------------------------------------------------</span>
<span class="co">#&gt;              text                       keyPhrases         </span>
<span class="co">#&gt; ------------------------------ ----------------------------</span>
<span class="co">#&gt;  Loved the food, service and    atmosphere, food, service  </span>
<span class="co">#&gt;  atmosphere! We'll definitely                              </span>
<span class="co">#&gt;            be back.                                        </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   Very good food, reasonable   reasonable prices, good food</span>
<span class="co">#&gt;   prices, excellent service.                               </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   It was a great restaurant.         great restaurant      </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   If steak is what you want,           steak, place        </span>
<span class="co">#&gt;       this is the place.                                   </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  The atmosphere is pretty bad        atmosphere, food      </span>
<span class="co">#&gt;  but the food is quite good.                               </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; The food is quite good but the       food, atmosphere      </span>
<span class="co">#&gt;   atmosphere is pretty bad.                                </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; I'm not sure I would come back          restaurant         </span>
<span class="co">#&gt;      to this restaurant.                                   </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   The food wasn't very good.               food            </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  While the food was good the          service, food        </span>
<span class="co">#&gt; service was a disappointment.                              </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  I was very disappointed with        service, entree       </span>
<span class="co">#&gt;    both the service and my                                 </span>
<span class="co">#&gt;            entree.                                         </span>
<span class="co">#&gt; -----------------------------------------------------------</span></code></pre></div>
</div>
</div>
<div id="demo-application" class="section level2">
<h2>Demo Application</h2>
<p>A test/demo Shiny web application is available <a href="https://github.com/philferriere/mscsshiny">here</a></p>
</div>
<div id="related-microsoft-cognitive-services-packages" class="section level2">
<h2>Related Microsoft Cognitive Services Packages</h2>
<p><code>{mscsweblm4r}</code>, a R Client for the Microsoft Cognitive Services <strong>Web Language Model</strong> REST API, is also available on <a href="https://cran.r-project.org/package=mscsweblm4r">CRAN</a></p>
</div>
<div id="credits" class="section level2">
<h2>Credits</h2>
<p>All Microsoft Cognitive Services components are Copyright (c) Microsoft.</p>
<p>For great introductions to the underlying REST API, please refer to this <a href="https://azure.microsoft.com/en-us/documentation/articles/cognitive-services-text-analytics-quick-start/">article</a> and this <a href="https://blogs.technet.microsoft.com/machinelearning/2015/04/08/introducing-text-analytics-in-the-azure-ml-marketplace/">blog post</a>.</p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
